module.exports=function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){t.exports=require("scenegraph")},function(t,e){t.exports=require("application")},function(t,e){t.exports=require("uxp")},function(t,e){t.exports=require("viewport")},function(t,e){t.exports=require("commands")},function(t,e){t.exports=require("assets")},function(t,e,r){t.exports=r(8)},function(t,e){t.exports={install:function(t,e,r){r.add("get",function(e,r,s){try{t.color;var n=t.quoted,o=t.functions.functionRegistry.get("color");t.functions.functionRegistry.get("escape");let i=new RegExp("\\[CONTROLLER:(.*)\\]","g").exec(e.value);if(i){let t=XDC.root,e=i[1];for(let i=0,a=t.children.length;i<a;i++){let a=t.children.at(i);if(a.name==`[CONTROLLER:${e}]`)for(let t=0,e=a.children.length;t<e;t++){let e=a.children.at(t);if(-1!=e.name.indexOf(r.value))switch(console.log("node",e.name),s.value){case"fill":return o(n('"',e.fill.toHex()));case"stroke-width":return console.log("node.strokeWidth",e.strokeWidth),e.strokeWidth;case"stroke-color":return o(n('"',e.stroke.toHex()));case"corner-radius":return e.cornerRadii.topLeft;case"font-family":return e.fontFamily}}}}}catch(t){console.log("ERROR IN CUSTOM FUNC: ",t)}})}}},function(t,e,r){"use strict";r.r(e);const s=r(0),{selection:n,root:o}=r(0),i=r(4),a=r(1),l=r(2).storage,c=r(3),p=r(2).storage.localFileSystem;const h=r(5),d=r(7);class u{constructor(t,e){this.entry=t,this.type=t.type,this.node=t.node,this.expressions=t.expressions,this.classes=t.classes||[],this.index=e,this.id,this.xdid=t.node.guid,this.closingTag,this.inner="",this.styles={},this.attributes={},this.children=[],this.renditions,this.process(t)}process(t){let e=/#([a-zA-Z]?[a-zA-Z0-9-_]*)/.exec(this.node.name);this.id=e?e[1]:"e"+this.index;const r=[f,g,y,m,x,b,k,w];for(var s=0;s<r.length;s++){let t=r[s];if(t.check(this,this.node)){t.apply(this,this.node);break}}}applyAttributes(){let t="";for(var e in t+=this.classes.length?`class="${this.classes.map(t=>t.replace(".","")).join(" ")}" `:"",this.attributes)t+=`${e}="${this.attributes[e]}" `;this.tagOpen=this.tagOpen.replace("#!ATTRIBUTES#",t)}}class f{static check(t,e){return"Artboard"==t.type}static apply(t,e){t.classes.push("artboard"),t.tagOpen=`<div ${$.getDefaultAttributes(t)} #!ATTRIBUTES#><div class="content">`,t.tagClose="</div></div>",t.styles.position="relative",$.applySize(t,e),t.styles["background-color"]=$.getFill(e).value}}class g{static check(t,e){return"Group"==t.type&&e.mask}static apply(t,e){x.apply(t,e),t.styles.width=`${e.boundsInParent.width}px`,t.styles.height=`${e.boundsInParent.height}px`}}class y{static check(t,e){return"Group"==t.type}static apply(t,e){t.tagOpen=`<div ${$.getDefaultAttributes(t)} #!ATTRIBUTES#>`,t.tagClose="</div>",$.applyTransformation(t,e),$.applyOpacity(t,e)}}class m{static check(t,e){return"Text"==t.type}static apply(t,e){{let r="";e.text.split(/\n/g).forEach((t,s)=>{let n=e.lineSpacing?e.lineSpacing:1.2*e.fontSize;r+=`<tspan x="0" dy="${s?n:0}px">${t}</tspan>`}),t.tagOpen=`<svg ${$.getDefaultAttributes(t)} xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" #!ATTRIBUTES#>`,t.tagClose="</svg>",t.inner=`<text x="0" y="0" style="font-family: ${e.fontFamily}; font-size: ${e.fontSize}px; fill: ${$.getFill(e).value}">\n      ${r}</text>`,t.styles.overflow="visible",$.applyTransformation(t,e),$.applyOpacity(t,e)}}}class x{static check(t,e){const r=$.getFill(e);if(r&&-1!=["ImageFill"].indexOf(r.type))return!0}static apply(t,e){t.type="Image",t.tagOpen=`<img ${$.getDefaultAttributes(t)} #!ATTRIBUTES#>`,t.tagClose="",t.renditions=[],t.renditions.push({id:t.id,element:t,node:e}),t.attributes.src=`${t.id}.jpg`,$.applySize(t,e),$.applyTransformation(t,e),$.applyOpacity(t,e)}}class b{static check(t,e){if(-1==["Rectangle"].indexOf(t.type))return!1;const r=$.getFill(e).type;return-1!=[void 0,"Color","LinearGradientFill","RadialGradientFill"].indexOf(r)}static apply(t,e){t.tagOpen=`<div ${$.getDefaultAttributes(t)} #!ATTRIBUTES#>`,t.tagClose="</div>",$.applySize(t,e),$.applyTransformation(t,e),$.applyOpacity(t,e),"Color"==$.getFill(e).type&&(t.styles["background-color"]=$.getFill(e).value),t.styles.border=`${e.strokeWidth}px solid ${$.getStroke(e).value}`,e.hasRoundedCorners&&(t.styles["border-radius"]=`${e.cornerRadii.topLeft}px ${e.cornerRadii.topRight}px ${e.cornerRadii.bottomRight}px ${e.cornerRadii.bottomLeft}px`)}}class k{static check(t,e){return-1!=["Ellipse"].indexOf(t.type)}static apply(t,e){t.tagOpen=`<svg ${$.getDefaultAttributes(t)} xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${e.localBounds.width}" height="${e.localBounds.height}" #!ATTRIBUTES#>`,t.tagClose="</svg>";let r=e.fillEnabled?`fill="${$.getFill(e).value}"`:'fill="none"',s=e.strokeEnabled?`stroke="${$.getStroke(e).value}"`:"";t.inner=`<ellipse id="${t.id}-ellipse"\n                              cx="${e.radiusX}" cy="${e.radiusY}" rx="${e.radiusX}" ry="${e.radiusY}"\n                              ${r}\n                              ${s}\n                              stroke-width="${e.strokeWidth}"\n                              />`,t.styles.overflow="visible",$.applyTransformation(t,e),$.applyOpacity(t,e)}}class w{static check(t,e){return-1!=["Path"].indexOf(t.type)}static apply(t,e){t.tagOpen=`<svg ${$.getDefaultAttributes(t)} xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" #!ATTRIBUTES#>`,t.tagClose="</svg>";let r=e.fillEnabled&&$.getFill(e).value?`fill="${$.getFill(e).value}"`:'fill="transparent"',s=e.strokeEnabled?`stroke="${$.getStroke(e).value}"`:"";t.inner=`<path id="${t.id}-path" d="${e.pathData}"\n                           ${r}\n                           ${s}\n                           stroke-width="${e.strokeWidth}"\n                            />`,t.styles.overflow="visible",$.applyTransformation(t,e),$.applyOpacity(t,e)}}class ${static num(t,e=2){const r=Math.pow(10,e);return Math.round(t*r)/r}static getDefaultAttributes(t){return`id="${t.id}"`}static applySize(t,e){e.width&&(t.styles.width=$.num(e.width)+"px"),e.height&&(t.styles.height=$.num(e.height)+"px")}static applyTransformation(t,e){if(0==e.rotation)t.styles.top=$.num(e.translation.y)+"px",t.styles.left=$.num(e.translation.x)+"px";else{const r=e.transform;t.styles["transform-origin"]="0 0",t.styles.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`}}static getFill(t){if(!t.fillEnabled||!t.fill)return!1;let e,r=t.fill.constructor.name;return"Color"==r&&(e=t.fill.a<255?`rgba(${t.fill.r}, ${t.fill.g}, ${t.fill.b}, ${Math.round(t.fill.a/255*100)/100})`:t.fill.toHex()),{type:r,value:e}}static getStroke(t){if(!t.strokeEnabled||!t.stroke)return!1;return{type:t.stroke.constructor.name,value:t.stroke.a<255?`rgba(${t.stroke.r}, ${t.stroke.g}, ${t.stroke.b}, ${Math.round(t.stroke.a/255*100)/100})`:t.stroke.toHex()}}static applyOpacity(t,e){e.opacity<1&&(t.styles.opacity=e.opacity)}}const E=r(1);r(2).storage.localFileSystem;var v={WebGraphCreator:class{constructor(t){t=t||{},this.nodes=[],this.elementIndex=t.startIndex||1}add(t){this.nodes.push(t)}async create(){try{const t={children:[]};for(let e=0;e<this.nodes.length;e++){let r=this.nodes[e];const s=await XDC.abstractScenegraph.get(r);this._generateEntry(s.root,t)}return t.lastAutoIdIndex=this.elementIndex,t.findById=function(t){let e=null,r=s=>{try{s.forEach(s=>{s.id==t?e=s:r(s.children)})}catch(t){console.log(LOG,"findById()",t)}};return r(this.children),e},t}catch(t){console.log("[ WebExport:WebGraphCreator ]",t)}}_generateEntry(t,e){let r=new u(t,this.elementIndex++);e.children.push(r),t.isMask||t.children.forEach(t=>{this._generateEntry(t,r)})}},WebRenderer:class{constructor(){}async render(t){try{let e={html:"",css:""};return t.children.forEach(t=>{this._process(t,e)}),e}catch(t){console.log("[ WebExport:WebRenderer ]",t)}}_process(t,e){t.applyAttributes(),e.html+=`\n${t.tagOpen}`,e.html+=t.inner,e.css+=`#${t.id} {\n`;for(let r in t.styles)t.styles.hasOwnProperty(r)&&(e.css+=`  ${r}: ${t.styles[r]};\n`);e.css+="}\n",t.children.forEach(t=>{this._process(t,e)}),e.html+=`\n${t.tagClose}`}},RenditionExporter:class{constructor(t){this.outputFolder=t,this.renditionList=[]}async export(t){try{for(var e=0;e<t.children.length;e++){let r=t.children[e];await this._process(r)}this.renditionList.length&&(await this.tweak(),await E.createRenditions(this.renditionList),await this.untweak())}catch(t){console.log("[ RenditionExporter ]",t)}}async _process(t,e){try{if(t.renditions)for(var r=0;r<t.renditions.length;r++){let e=t.renditions[r],s=await this._createRenditionDefinition(e);this.renditionList.push(s)}for(let r=0;r<t.children.length;r++){let s=t.children[r];await this._process(s,e)}}catch(t){console.log("[ RenditionExporter ]",t)}}async _createRenditionDefinition(t){try{const e=await this.outputFolder.createFile(t.id+".jpg",{overwrite:!0});return{node:t.node,outputFile:e,type:E.RenditionType.JPG,minify:!0,embedImages:!0,scale:2,quality:70}}catch(t){console.log("[ RenditionExporter ]",t)}}async tweak(){try{this.renditionList.forEach(async t=>{let e=0,r=function(t){e+=t.rotation,t.parent&&"RootNode"!=t.parent.constructor.name&&r(t.parent)};r(t.node),t.__finalRotation=e,t.node.rotation&&t.node.rotateAround(-e,t.node.localCenterPoint)})}catch(t){console.log("[ RenditionExporter ]",t)}}async untweak(){try{this.renditionList.forEach(async t=>{if(null!=t.__finalRotation&&0!=t.__finalRotation)try{t.node.rotateAround(t.__finalRotation,t.node.localCenterPoint)}catch(t){console.log("[ RenditionExporter ]",t)}})}catch(t){console.log("[ RenditionExporter ]",t)}}}};class R{constructor(t,e){this.entry=t,this.type=t.type,this.node=t.node,this.expressions=t.expressions,this.classes=t.classes||[],this.index=e,this.id,this.tag,this.xdid=t.node.guid,this.closingTag,this.inner="",this.styles={},this.attributes={},this.children=[],this.renditions,this.process(t)}process(t){let e=/#([a-zA-Z]?[a-zA-Z0-9-_]*)/.exec(this.node.name);this.id=e?e[1]:"e"+this.index;const r=[S,C,A,O,T,_,D,F,L];for(var s=0;s<r.length;s++){let t=r[s];if(t.check(this,this.node)){t.apply(this,this.node);break}}}}class S{static check(t,e){return-1!=["Artboard"].indexOf(t.type)}static apply(t,e){t.tagOpen=`\n      <rect ${P.getDefaultAttributes(t)}\n            ${P.getAttributes(t)}\n            width="${P.num(e.width)}" height="${P.num(e.height)}"/>`,t.tagClose="",t.styles.fill=e.fillEnabled&&"Color"==P.getFill(e).type?P.getFill(e).value:"transparent"}}class C{static check(t,e){return"Group"==t.type&&e.mask}static apply(t,e){T.apply(t,e),t.styles.width=`${e.boundsInParent.width}px`,t.styles.height=`${e.boundsInParent.height}px`}}class A{static check(t,e){return"Group"==t.type}static apply(t,e){const r=e.transform;t.attributes.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`,t.tagOpen=`\n      <g ${P.getDefaultAttributes(t)}\n            ${P.getAttributes(t)}>`,t.tagClose="</g>"}}class O{static check(t,e){return"Text"==t.type}static apply(t,e){let r="";e.text.split(/\n/g).forEach((t,s)=>{let n=e.lineSpacing?e.lineSpacing:1.2*e.fontSize;r+=`<tspan x="0" dy="${s?n:0}px">${t}</tspan>`}),t.tagOpen=`<svg ${P.getDefaultAttributes(t)} xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">`,t.tagClose="</svg>",t.inner=`<text x="0" y="0" style="font-family: ${e.fontFamily}; font-size: ${e.fontSize}px; fill: ${P.getFill(e).value}">\n    ${r}</text>`,t.styles.overflow="visible",P.applyTransformation(t,e),P.applyOpacity(t,e)}}class T{static check(t,e){const r=P.getFill(e);if(r&&-1!=["ImageFill"].indexOf(r.type))return!0}static apply(t,e){t.tag="img",t.tagOpen=`<img ${P.getDefaultAttributes(t)} src="${t.id}.png">`,t.tagClose="",t.renditions=[],t.renditions.push({id:t.id,element:t,node:e}),t.attributes.src=`${t.id}.png`,P.applySize(t,e),P.applyTransformation(t,e),P.applyOpacity(t,e)}}class _{static check(t,e){return-1!=["Line"].indexOf(t.type)}static apply(t,e){t.attributes.x1=P.num(e.start.x),t.attributes.y1=P.num(e.start.y),t.attributes.x2=P.num(e.end.x),t.attributes.y2=P.num(e.end.y);const r=e.transform;t.attributes.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`,t.tagOpen=`\n      <line ${P.getDefaultAttributes(t)}\n            ${P.getAttributes(t)} />`,t.tagClose="",P.applyOpacity(t,e),t.styles.stroke=`${P.getStroke(e).value}`,t.styles["stroke-width"]=`${e.strokeWidth}px`}}class D{static check(t,e){if(-1==["Rectangle"].indexOf(t.type))return!1;const r=P.getFill(e).type;return-1!=[void 0,"Color","LinearGradientFill","RadialGradientFill"].indexOf(r)}static apply(t,e){const r=e.transform;t.attributes.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`,e.hasRoundedCorners&&(t.attributes.rx=e.cornerRadii.topLeft,t.attributes.ry=e.cornerRadii.topLeft),t.tagOpen=`\n      <rect ${P.getDefaultAttributes(t)}\n            ${P.getAttributes(t)}\n            width="${P.num(e.width)}" height="${P.num(e.height)}"/>`,t.tagClose="",P.applyOpacity(t,e),t.styles.fill=e.fillEnabled&&"Color"==P.getFill(e).type?P.getFill(e).value:"transparent",t.styles.stroke=`${P.getStroke(e).value}`,t.styles["stroke-width"]=`${e.strokeWidth}px`}}class F{static check(t,e){return-1!=["Ellipse"].indexOf(t.type)}static apply(t,e){t.attributes.rx=e.radiusX,t.attributes.ry=e.radiusY,t.attributes.cx=P.num(e.radiusX),t.attributes.cy=P.num(e.radiusY);const r=e.transform;t.attributes.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`,e.hasRoundedCorners&&(t.attributes.rx=e.cornerRadii.topLeft,t.attributes.ry=e.cornerRadii.topLeft),t.tagOpen=`\n      <ellipse ${P.getDefaultAttributes(t)}\n               ${P.getAttributes(t)} />`,t.tagClose="",P.applyOpacity(t,e),t.styles.fill=e.fillEnabled&&"Color"==P.getFill(e).type?P.getFill(e).value:"transparent",t.styles.stroke=`${P.getStroke(e).value}`,t.styles["stroke-width"]=`${e.strokeWidth}px`}}class L{static check(t,e){return-1!=["Path"].indexOf(t.type)}static apply(t,e){t.attributes.y=P.num(e.translation.y),t.attributes.x=P.num(e.translation.x);const r=e.transform;t.attributes.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`,e.hasRoundedCorners&&(t.attributes.rx=e.cornerRadii.topLeft,t.attributes.ry=e.cornerRadii.topLeft),t.tagOpen=`\n      <path ${P.getDefaultAttributes(t)}\n               ${P.getAttributes(t)}\n               d="${e.pathData}" />`,t.tagClose="",P.applyOpacity(t,e),t.styles.fill=e.fillEnabled&&"Color"==P.getFill(e).type?P.getFill(e).value:"transparent",t.styles.stroke=`${P.getStroke(e).value}`,t.styles["stroke-width"]=`${e.strokeWidth}px`}}class P{static num(t,e=2){const r=Math.pow(10,e);return Math.round(t*r)/r}static getDefaultAttributes(t){let e=t.classes?`class="${t.classes.map(t=>t.replace(".","")).join(" ")}"`:"";return`id="${t.id}" ${e}`}static getAttributes(t){let e="";for(let r in t.attributes)e+=` ${r}="${t.attributes[r]}"`;return e}static applySize(t,e){e.width&&(t.styles.width=P.num(e.width)+"px"),e.height&&(t.styles.height=P.num(e.height)+"px")}static applyTransformation(t,e){if(0==e.rotation&&"Path"!=t.type&&"Group"!=t.type)"Ellipse"==t.type?(t.styles.cy=P.num(e.translation.y)+P.num(e.radiusY)+"px",t.styles.cx=P.num(e.translation.x)+P.num(e.radiusX)+"px"):(t.styles.y=P.num(e.translation.y)+"px",t.styles.x=P.num(e.translation.x)+"px");else{const r=e.transform;t.styles["transform-origin"]="0 0",t.styles.transform=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`}}static getFill(t){if(!t.fillEnabled||!t.fill)return!1;let e,r=t.fill.constructor.name;return"Color"==r&&(e=t.fill.a<255?`rgba(${t.fill.r}, ${t.fill.g}, ${t.fill.b}, ${Math.round(t.fill.a/255*100)/100})`:t.fill.toHex()),{type:r,value:e}}static getStroke(t){if(!t.strokeEnabled||!t.stroke)return!1;return{type:t.stroke.constructor.name,value:t.stroke.a<255?`rgba(${t.stroke.r}, ${t.stroke.g}, ${t.stroke.b}, ${Math.round(t.stroke.a/255*100)/100})`:t.stroke.toHex()}}static applyOpacity(t,e){e.opacity<1&&(t.styles.opacity=e.opacity)}}const N=r(1),G=r(2).storage.localFileSystem;var I={SvgGraphCreator:class{constructor(){this.nodes=[],this.elementIndex=1}add(t){this.nodes.push(t)}async create(){try{let t={children:[]};for(let e=0;e<this.nodes.length;e++){let r=this.nodes[e];const s=await XDC.abstractScenegraph.get(r);this._generateEntry(s.root,t)}return t}catch(t){console.log("[ SvgExport:SvgGraphCreator ]",t)}}_generateEntry(t,e){let r=new R(t,this.elementIndex++);e.children.push(r),t.isMask||t.children.forEach(t=>{this._generateEntry(t,r)})}},SvgRenderer:class{constructor(){}async render(t){try{let e={svg:"",css:""};return t.children.forEach(t=>{this._process(t,e)}),e}catch(t){console.log("[ SvgExport:SvgRenderer ]",t)}}_process(t,e){e.svg+=`\n${t.tagOpen}`,e.svg+=t.inner,e.css+=`#${t.id} {\n`;for(let r in t.styles)t.styles.hasOwnProperty(r)&&(e.css+=`  ${r}: ${t.styles[r]};\n`);e.css+="}\n",t.children.forEach(t=>{this._process(t,e)}),e.svg+=`\n${t.tagClose}`}},RenditionExporter:class{constructor(){this.renditionList=[]}async export(t){try{for(var e=0;e<t.children.length;e++){let r=t.children[e];await this._process(r)}this.renditionList.length&&(await this.tweak(),await N.createRenditions(this.renditionList),await this.untweak())}catch(t){console.log("[ RenditionExporter ]",t)}}async _process(t,e){try{if(t.renditions)for(var r=0;r<t.renditions.length;r++){let e=t.renditions[r],s=await this._createRenditionDefinition(e);this.renditionList.push(s)}for(let r=0;r<t.children.length;r++){let s=t.children[r];await this._process(s,e)}}catch(t){console.log("[ RenditionExporter ]",t)}}async _createRenditionDefinition(t){try{const e=await G.getDataFolder(),r=await e.createFile(t.id+".png",{overwrite:!0});return{node:t.node,outputFile:r,type:N.RenditionType.PNG,minify:!0,embedImages:!0,scale:2,quality:70}}catch(t){console.log("[ RenditionExporter ]",t)}}async tweak(){try{this.renditionList.forEach(async t=>{let e=0,r=function(t){e+=t.rotation,t.parent&&"RootNode"!=t.parent.constructor.name&&r(t.parent)};r(t.node),t.__finalRotation=e,t.node.rotation&&t.node.rotateAround(-e,t.node.localCenterPoint)})}catch(t){console.log("[ RenditionExporter ]",t)}}async untweak(){try{this.renditionList.forEach(async t=>{if(null!=t.__finalRotation&&0!=t.__finalRotation)try{t.node.rotateAround(t.__finalRotation,t.node.localCenterPoint)}catch(t){console.log("[ RenditionExporter ]",t)}})}catch(t){console.log("[ RenditionExporter ]",t)}}}};r(0);const{selection:B,root:X}=r(0);class M{static parseNodeName(t){return this.parse(t)}static parse(t){let e=new z;let r=t.name.match(/@[a-zA-Z]{1}[a-zA-Z\.]*({.*?})?/g);return r&&r.forEach(r=>{let[s,n]=r.split("@");const o=new W(t,n="@"+n);e.add(o)}),e}}class z{constructor(){this.expressions=[]}add(t){this.expressions.push(t)}get(t){return t?this.expressions.filter(e=>e.command==t)[0]:this.expressions}}class W{constructor(t,e){this.node=t,this.expressionString=e,this.arguments=[];let[r,s,n]=/@([a-zA-Z]{1}[a-zA-Z\.]*)({.*?})?/.exec(e);this.command=s;if(n){let t=(n=n.trim().replace("{","").replace("}","")).split(",");for(let e=0,r=t.length;e<r;e++){let r=t[e].split(":"),s="string"==typeof r[1]?r[1].trim():void 0,n="true"==s||"false"!=s&&(!Number.isNaN(Number(s))&&Number.parseFloat(s)?Number.parseFloat(s):s);if(r[0]&&null!=n){let t={key:r[0].trim(),value:n};this.arguments.push(t)}}}}get(t){for(let e=0,r=this.arguments.length;e<r;e++){let r=this.arguments[e];if(r.key==t)return r.value}}set(t,e){for(let r=0,s=this.arguments.length;r<s;r++){let s=this.arguments[r];if(s.key==t)return s.value=e,void this.persist()}this.arguments.push({key:t,value:e}),this.persist()}toExpressionString(){let t=`@${this.command}`;return this.arguments.length&&(t+="{",this.arguments.forEach(e=>{null!=e.value&&(t+=`${e.key}: ${e.value}, `)}),t=t.substr(0,t.length-2),t+="}"),t}persist(){this.node.name=this.node.name.replace(this.expressionString,this.toExpressionString())}}const Y="[ AbstractScenegraph ]";class q{static async processNode(t,e){try{e.type=t.constructor.name,e.name=t.name,e.node=t,e.expressions=XDC.expressions.getExpressionsByNode(t),e.classes=q.getClasses(t.name);for(let r=0;r<t.children.length;r++){const s=t.children.at(r),n=new j;n.isMask=!!s.mask,e.children.push(n),await this.processNode(s,n)}}catch(t){console.log(Y,t)}}static getClasses(t){return t.match(/(^|\W)\.[\w-]+/g)}}class j{constructor(){this.node,this.expressions,this.isMask=!1,this.children=[]}}const H=r(0),J=r(1),U=r(3),Z=r(4),V=r(5);e.default={scenegraph:H,root:H.root,selection:H.selection,commands:Z,application:J,viewport:U,assets:V,XdTpl:class{constructor(){this.version="1.8"}place(t,e){return new Promise((r,s)=>{try{e=e||{},p.getPluginFolder().then(s=>{s.getEntry(t).then(t=>{t.read().then(t=>{e.offsetX=e.offsetX?e.offsetX:0,e.offsetY=e.offsetY?e.offsetY:0;const s=JSON.parse(t);let a,l=n.editContext;a=l==o?XDC.core.getBounds():XDC.core.getBounds([n.items[0]]);const p=this.import(l,s)[0];if(p.name=e.rename?e.rename:p.name,"rightTop"==e.position)p.placeInParentCoordinates({x:p.localBounds.x,y:p.localBounds.y},{x:a.right+100,y:a.top});else{const t=XDC.viewport.bounds,e={x:t.x+t.width/2-p.localBounds.width/2,y:t.y+t.height/2-p.localBounds.height/2};p.placeInParentCoordinates({x:p.localBounds.x,y:p.localBounds.y},e)}!0===e.ungroup?i.ungroup():n.items=p,c.scrollIntoView(n.items[0]),r({node:p})})})})}catch(t){console.log("Error during XDTPL place()",t)}})}async export(t){const e={type:"XDTPL",version:this.version,sets:[]};for(let r=0;r<t.length;r++){let s=t[r];const n={name:`set_${r}`,type:"Set",children:[]};n.children.push(await this._exportNode(s)),e.sets.push(n)}return JSON.stringify(e,null,0)}async _exportNode(t){const e={type:t.constructor.name};if([{property:"name"},{property:"width"},{property:"height"},{property:"text"},{property:"areaBox"},{property:"textAlign"},{property:"lineSpacing"},{property:"radiusX"},{property:"radiusY"},{property:"translation"}].forEach(r=>{null!=t[r.property]&&(e[r.property]=t[r.property])}),t.styleRanges&&t.styleRanges.length&&(e.styleRanges=[],t.styleRanges.forEach(t=>{e.styleRanges.push({length:t.length,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontSize:t.fontSize,fill:t.fill.toHex()})})),t.cornerRadii&&(e.cornerRadii={topLeft:t.cornerRadii.topLeft,topRight:t.cornerRadii.topRight,bottomRight:t.cornerRadii.bottomRight,bottomLeft:t.cornerRadii.bottomLeft}),0!=t.rotation&&(e.rotation=t.rotation,e.rotationPoint=t.localCenterPoint),t.opacity<1&&(e.opacity=t.opacity),t.mask&&(e.mask=!0),t.fillEnabled&&(e.fillEnabled=t.fillEnabled,t.fill))switch(e.fill={type:t.fill.constructor.name},t.fill.constructor.name){case"Color":e.fill.hex=t.fill.toHex(),e.fill.alpha=Math.round(t.fill.a/255*100)/100;break;case"LinearGradientFill":e.fill.startX=t.fill.startX,e.fill.startY=t.fill.startY,e.fill.endX=t.fill.endX,e.fill.endY=t.fill.endY,e.fill.colorStops=[],t.fill.colorStops.forEach(t=>{e.fill.colorStops.push({color:t.color.toHex(),alpha:t.color.a/255,stop:t.stop})});break;case"ImageFill":try{let r=t.fill.naturalWidth/t.width;r=r>6?6:r;const s=await p.getTemporaryFolder(),n=await s.createEntry("xdtpl_export_image.tmp",{overwrite:!0});await new Promise((s,o)=>{let i=[{node:t,outputFile:n,type:"image/jpeg"==t.fill.mimeType?a.RenditionType.JPG:a.RenditionType.PNG,scale:r,quality:70}];a.createRenditions(i).then(async t=>{const r=await n.read({format:l.formats.binary});e.fill.base64=XDC.misc.arrayBufferToBase64(r),s()}).catch(t=>{console.log("[ XDTPL Error ] Error during creation of temp image to extract base64",t),o()})})}catch(t){console.log("[ XDTPL ] Error in _exportNode(): ",t)}}if(t.strokeEnabled&&t.stroke&&(e.strokeEnabled=t.strokeEnabled,e.stroke=t.stroke.toHex(),e.strokeWidth=t.strokeWidth,e.strokePosition=t.strokePosition,e.strokeEndCaps=t.strokeEndCaps,e.strokeJoins=t.strokeJoins,e.strokeMiterLimit=t.strokeMiterLimit,e.strokeDashOffset=t.strokeDashOffset,t.strokeDashArray.length&&(e.strokeDashArray=[],t.strokeDashArray.forEach(t=>e.strokeDashArray.push(t)))),t.blur&&(e.blur={blurAmount:t.blur.blurAmount,brightnessAmount:t.blur.brightnessAmount,fillOpacity:t.blur.fillOpacity,isBackgroundEffect:t.blur.isBackgroundEffect,visible:t.blur.visible}),t.shadow){let r={hex:t.shadow.color.toHex(),alpha:Math.round(t.shadow.color.a/255*100)/100};e.shadow={x:t.shadow.x,y:t.shadow.y,blur:t.shadow.blur,color:r,visible:t.shadow.visible}}if("Line"==t.constructor.name&&(e.startX=t.start.x,e.startY=t.start.y,e.endX=t.end.x,e.endY=t.end.y),"Path"==t.constructor.name&&(e.pathData=t.pathData),t.children&&t.children.length){e.children=[];for(var r=0;r<t.children.length;r++){const s=t.children.at(r);e.children.push(await this._exportNode(s))}}return e}import(t,e){try{const r=[];return e.sets.forEach((e,s)=>{e.children.forEach((e,s)=>{r.push(this._createNode(e,t,[]))})}),r}catch(t){console.log("XdTpl import Error:",t)}}_createNode(t,e,r){try{let o;if(["Group","SymbolInstance","BooleanGroup","RepeatGrid"].indexOf(t.type)>=0&&(r=[]),"Group"!=t.type&&"RepeatGrid"!=t.type&&"SymbolInstance"!=t.type&&"BooleanGroup"!=t.type&&((o=new s[t.type]).name=t.name,this._addTypeSpecificProperties(o,t),t.rotation&&o.rotateAround(t.rotation,t.rotationPoint),o.translation=t.translation,"Artboard"==t.type?(XDC.core.addArtboard(o),e=o):e.addChild(o),o&&r.push(o)),t.children&&t.children.length&&t.children.forEach(t=>{let s=this._createNode(t,e,r);s&&["Group","SymbolInstance","BooleanGroup","RepeatGrid"].indexOf(s.constructor.name)>=0&&r.push(s)}),["Group","SymbolInstance","BooleanGroup","RepeatGrid"].indexOf(t.type)>=0&&r.length){n.items=r,t.mask,i[t.mask?"createMaskGroup":"group"]();let e=n.items[0];e.name=t.name,e.translation=t.translation,t.opacity&&(e.opacity=parseFloat(t.opacity)),t.rotation&&(e.rotateAround(t.rotation,t.rotationPoint),e.placeInParentCoordinates({x:0,y:0},{x:t.translation.x,y:t.translation.y})),o=e}return o}catch(t){console.error("Error in XDTPL._createNode():",t.message)}}_addTypeSpecificProperties(t,e){switch(e.type){case"Artboard":case"Rectangle":t.width=e.width,t.height=e.height}switch(e.type){case"Artboard":this._addFillAndStroke(t,e);break;case"Line":case"Rectangle":case"Ellipse":case"Path":t.opacity=null!=e.opacity?e.opacity:1,this._addFillAndStroke(t,e);break;case"Text":t.opacity=null!=e.opacity?e.opacity:1}switch(this._addBlur(t,e),this._addShadow(t,e),e.type){case"Line":t.setStartEnd(e.startX,e.startY,e.endX,e.endY);break;case"Rectangle":e.cornerRadii&&(t.cornerRadii=e.cornerRadii);break;case"Ellipse":t.radiusX=e.radiusX,t.radiusY=e.radiusY;break;case"Path":t.pathData=e.pathData;break;case"Text":t.text=e.text,t.areaBox=e.areaBox;let r=JSON.parse(JSON.stringify(e.styleRanges));r.forEach(t=>{t.fill=new s.Color(t.fill)}),t.styleRanges=r,t.textAlign=e.textAlign,t.lineSpacing=e.lineSpacing}}_addFillAndStroke(t,e){switch("Artboard"!=e.type&&"Line"!=e.type&&(t.fillEnabled=e.fillEnabled||!1),e.fill?e.fill.type:null){case"Color":t.fill=new s.Color(e.fill.hex,e.fill.alpha);break;case"LinearGradientFill":const r=new s.LinearGradient;r.setEndPoints(e.fill.startX,e.fill.startY,e.fill.endX,e.fill.endY);const n=[];e.fill.colorStops.forEach(t=>{n.push({color:new s.Color(t.color,t.color.alpha),stop:t.stop})}),r.colorStops=n,t.fill=r;break;case"ImageFill":const o=new s.ImageFill(`data:image/jpeg;base64,${e.fill.base64}`);t.fill=o}"Artboard"!=e.type&&(t.strokeEnabled=e.strokeEnabled||!1),e.strokeEnabled&&(t.stroke=new s.Color(e.stroke),t.strokeWidth=e.strokeWidth,t.strokePosition=e.strokePosition,e.strokeEndCaps&&(t.strokeEndCaps=e.strokeEndCaps),e.strokeJoins&&(t.strokeJoins=e.strokeJoins),e.strokeMiterLimit&&(t.strokeMiterLimit=e.strokeMiterLimit),e.strokeDashOffset&&(t.strokeDashOffset=e.strokeDashOffset),e.strokeDashArray&&(t.strokeDashArray=e.strokeDashArray))}_addBlur(t,e){e.blur&&(t.blur=new s.Blur(e.blur.blurAmount,e.blur.brightnessAmount,e.blur.fillOpacity,e.blur.visible,e.blur.isBackgroundEffect))}_addShadow(t,e){if(!e.shadow)return;let r=new s.Color(e.shadow.color.hex,e.shadow.color.alpha);t.shadow=new s.Shadow(e.shadow.x,e.shadow.y,e.shadow.blur,r,e.shadow.visible)}},XdCss:class{constructor(t){this.debug=!1,this.styleGraph,this.classGraph,this.affectedElements}async parse(t){return new Promise((e,r)=>{let s={};h.colors.get().forEach(t=>{s[t.name]=t.color.toHex()}),less.render(t,{plugins:[d],globalVars:s}).then(t=>{let s=t.css.replace(/\/\*([\s\S]*?)\*\//g,"");try{let t=[];s.split("}").forEach(e=>{let r=e.split("{");if(0===r[0].trim().length||0===r[1].trim().length)return;let s={selectors:[],properties:{}};t.push(s);let n=r[0].split(",");for(var o=0;o<n.length;o++){let t=[];n[o].trim().split(" ").forEach(e=>{let r=e.split(".").map(t=>t="."+t);r.shift(),t.push(r)}),s.selectors.push(t)}let i=r[1].split(";");for(o=0;o<i.length-1;o++){let t=i[o].split(":"),e=t[0].replace(/\n/g,"").trim();s.properties[e]=t[1].replace(/\n/g,"").trim()}}),e(t),this.styleGraph=t}catch(t){console.log("Error while parsing CSS",t),r(t)}},function(t){console.log("Error while parsing CSS",t),r(t)})})}generateClassGraph(t){try{function e(t){return t.name.match(/(\.[a-zA-Z0-9-_]+)/g)}let r=function(t,s,n){let o=e(t);if(o){n.push(o);let e=[];n.forEach(t=>e.push(t)),e.pop();let r={type:t.constructor.name,classes:o,path:e,node:t};s.children=s.children?s.children:[],s.children.push(r),s=r}return t.children&&t.children.length&&t.children.forEach(t=>{-1==["SymbolInstance","RepeatGrid","BooleanGroup"].indexOf(t.constructor.name)&&r(t,s,n)}),o&&n.pop(),s},s=[];return t.parent&&function t(r){let n=e(r.parent);n&&s.unshift(n),r.parent&&"RootNode"!=r.parent.constructor.name&&t(r.parent)}(t),this.classGraph=r(t,{children:[]},s),this.classGraph}catch(t){console.log("Error in XdCss.queryNodesWithClasses():",t)}}logClassGraphOutline(t){!function t(e,r){e.children.forEach(e=>{let s="";for(var n=0;n<r;n++)s+="   ";console.log(s,e.node.name,`(${e.type})`,e.path),e.children&&(t(e,++r),r--)})}(this.generateClassGraph(t),0)}async render(t,e){const r=(new Date).getTime();let s=await this.parse(e);console.log("parse:             ",(new Date).getTime()-r,"ms");const n=(new Date).getTime();let o=this.generateClassGraph(t);console.log("classGraph:        ",(new Date).getTime()-n,"ms");let i=0,a=(t,e)=>{t.children.forEach(t=>{let r="";for(var n=0;n<e;n++)r+="   ";this.debug&&console.log(r,t.node.name,`(${t.type})`,t.classes,"path:",t.path),i++,this._renderClassGraphNode(t,s),t.children&&(a(t,++e),e--)})};a(o,0),this.affectedElements=i}_renderClassGraphNode(t,e){const r="                                 ";if(e.forEach(e=>{for(let o=0,i=e.selectors.length;o<i;o++){let i=e.selectors[o];this.debug&&console.log("                              (?) selector:",i);let a=this;function s(t,e){let s=t[t.length-1],n=!0,o=!1;for(let t=0,r=s.length;t<r;t++){let r=s[t];if(-1==e.classes.indexOf(r))return n=!1,!1}if(a.debug&&console.log(r,"classMatches:",n),n){if(0===e.path.length&&t.length>1)return!1;if(0===e.path.length&&1===t.length)return!0;if(1===t.length)return!0}let i=Array.from(e.path),l=(e,s)=>{let n=t[e];a.debug&&console.log(r,"next test: currentSelectorSegment:",n);let c=i.findIndex(t=>{a.debug&&console.log(r," *?# SEARCH:",n,"  IN ",t);for(let e=0,r=n.length;e<r;e++)if(-1===t.indexOf(n[e]))return!1;return!0});a.debug&&console.log(r," + pathIndex",c),a.debug&&console.log(r," + lastPathIndex",s);const p=i.splice(0,c+1).length;c<s||-1!=c&&(++e<t.length-1?l(e,c-p):o=!0)};return l(0,-999),a.debug&&console.log(r,"check: pathMatches:",o),n&&o}let l=s(i,t);if(this.debug&&console.log(r,l?"✅ ":"✖",e.selectors),l)for(var n in t.cache=t.cache?t.cache:{},e.properties)t.cache[n]=e.properties[n]}}),t.cache)for(var s in t.cache){const e=t.node,r=t.cache[s];switch(s){case"background-color":case"fill":const t=h.colors.get().filter(t=>t.name==r);t&&t.length>0&&t[0].color?e.fill=t[0].color:e.fill=new XDC.scenegraph.Color(r);break;case"stroke":case"stroke-color":e.stroke=new XDC.scenegraph.Color(r),e.strokeEnabled=!0;break;case"stroke-width":e.strokeWidth=Number(r),e.strokeEnabled=!0;break;case"corner-radius":-1!=["Rectangle"].indexOf(e.constructor.name)&&e.setAllCornerRadii(Number(r));break;case"font-family":-1!=["Text"].indexOf(e.constructor.name)&&(e.fontFamily=r);break;case"font-size":-1!=["Text"].indexOf(e.constructor.name)&&(e.fontSize=Number(r));break;case"font-style":-1!=["Text"].indexOf(e.constructor.name)&&(e.fontStyle=r)}}}},webExport:v,svgExport:I,core:class{static getAllArtboards(){return X.children.filter(t=>"Artboard"==t.constructor.name)}static getLastArtboard(){return this.getAllArtboards().pop()}static addArtboard(t){let e=this.getLastArtboard();e?X.addChildAfter(t,e):X.children.at(0)?X.addChildBefore(t,X.children.at(0)):X.addChild(t)}static getBounds(t,e){t=t||X.children,e="global"!=e&&"local"!=e?"parent":e;let r={left:null,top:null,right:null,bottom:null,width:null,height:null};return t.forEach(t=>{const s="global"==e?t.globalBounds:"parent"==e?t.boundsInParent:t.localBounds;(null==r.left||s.x<r.left)&&(r.left=s.x),(null==r.top||s.y<r.top)&&(r.top=s.y),(null==r.right||s.x+s.width>r.right)&&(r.right=s.x+s.width),(null==r.bottom||s.y+s.height>r.bottom)&&(r.bottom=s.y+s.height)}),r.width=r.right-r.left,r.height=r.bottom-r.top,r}static getChildIndex(t){for(let e=0;e<t.parent.children.length;e++)if(t.parent.children.at(e)==t)return e}static getChildByIndex(t,e){return t.children.at(e)}static closestMasterComponent(t){for(;t.parent;){if("SymbolInstance"==t.constructor.name&&t.isMaster)return t;t=t.parent}return!1}},query:class{static exec(){console.log("query::exec")}static queryByExpression(t,e){e.levels=null!=e.levels?e.levels:9999;const r=[];let s=(t,e,n)=>{let o=XDC.expressions.getExpressionsByNode(t).get(e.expression);o&&n<=e.levels+1&&r.push({node:t,expression:o,level:n}),t.children.forEach(t=>{s(t,e,++n),n--})};return"Array"==t.constructor.name||"SceneNodeList"==t.constructor.name?t.forEach(t=>{s(t,e,0)}):s(t,e,0),r}static query(t,e){const r=[];let s=(t,e)=>{let n={};for(const r in e){let s;switch(r){case"type":e[r]instanceof Array?e[r].forEach(e=>{s||(s=t.constructor.name==e)}):s=t.constructor.name==e[r];break;case"fill":t.fill&&"Color"==t.fill.constructor.name&&(s=e[r].exec(t.fill.toHex()));break;default:s=e[r].exec(t[r])}n[r]=s}if(Object.getOwnPropertyNames(n)){let e=!0;for(let t in n)n[t]||(e=!1);e&&r.push({node:t,results:n})}t.children.forEach(t=>{s(t,e)})};return"Array"==t.constructor.name||"SceneNodeList"==t.constructor.name?t.forEach(t=>{s(t,e)}):s(t,e),r}static getParentArtboard(t){if(!(t=t||XDC.selection.items[0]))return!1;for(;t.parent;){if("Artboard"==t.constructor.name)return t;t=t.parent}return!1}},expressions:class{static set(t,e,r,s){let n=M.parse(t).get(e);n?n.set(r,s):t.name+=` @${e}{${r}: ${s}}`}static remove(t,e){let r=M.parse(t).get(e);if(r)return t.name=t.name.replace(r.toExpressionString(),""),!0}static get(t,e,r){let s=M.parseNodeName(t);if(!e)return s.get().length?s:void 0;let n=s.get(e);return r?n?n.get(r):void 0:n}static getExpressionsByNode(t){return M.parseNodeName(t)}static getNodeNameWithoutExpressions(t){let e=this.get(t);if(!e)return t.name;let r=t.name;return e.expressions.forEach(t=>{r=r.replace(t.expressionString,"")}),r}static execute(){}},abstractScenegraph:class{static async get(t){return new Promise(async(e,r)=>{try{console.log("\n\n"),console.log(Y);const r={type:"ASC",version:"1.0.0",root:new j};await q.processNode(t,r.root),e(r)}catch(t){console.log(Y,t)}})}},misc:class{static arrayBufferToBase64(t){for(var e,r="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(t),o=n.byteLength,i=o%3,a=o-i,l=0;l<a;l+=3)r+=s[(16515072&(e=n[l]<<16|n[l+1]<<8|n[l+2]))>>18]+s[(258048&e)>>12]+s[(4032&e)>>6]+s[63&e];return 1==i?r+=s[(252&(e=n[a]))>>2]+s[(3&e)<<4]+"==":2==i&&(r+=s[(64512&(e=n[a]<<8|n[a+1]))>>10]+s[(1008&e)>>4]+s[(15&e)<<2]+"="),r}}}}]).default;